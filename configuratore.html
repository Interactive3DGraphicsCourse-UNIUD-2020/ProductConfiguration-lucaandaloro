<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Configuratore - Progetto Vespa Piaggio</title>
		<link rel="icon" href="images/site/Vespa.png">
		<!-- CSS FILES -->
		<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/uikit@latest/dist/css/uikit.min.css">
    		<link rel="stylesheet" type="text/css" href="css/stile.css">
    	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
		<script src="lib/three.min.js"></script>
		<script src="lib/BufferGeometryUtils.js"></script>
		<script src="lib/stats.min.js"></script>
		<script src="lib/Coordinates.js"></script>
		<script src="lib/OrbitControls.js"></script>
		<script src="lib/GLTFLoader.js"></script>
		<script src='lib/dat.gui.min.js'></script>
		<script src="js/materiali.js"></script>
		<script src="js/modello.js"></script>
		<script src="js/cambiaAmbiente.js"></script>
		<script src="js/cambiaScocca.js"></script>
		<script src="js/cambiaSella.js"></script>
		<script src="js/cambiaManopola.js"></script>
	
		
			<!-- shaders -->

			<script type="text/x-glsl" id="vertex_glossy">
				precision highp float;
				precision highp int;
				attribute vec4 tangent;
				varying vec3 vNormal;
				varying vec3 vTangent;
				varying vec3 vBitangent;
				varying vec3 vPosition;
				varying vec2 vUv;
		
				void main() {
					vec4 vPos = modelViewMatrix * vec4( position, 1.0 );
					vPosition = vPos.xyz;
					vNormal = normalize(normalMatrix * normal);
					vec3 objectTangent = vec3( tangent.xyz );
					vec3 transformedTangent = normalMatrix * objectTangent;
					vTangent = normalize( transformedTangent );
					vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
					vUv = uv;
					gl_Position = projectionMatrix * vPos;
				}
				</script>
		
				<script type="text/x-glsl" id="fragment_glossy">
					precision highp float;
					precision highp int;
					varying vec3 vNormal;
					varying vec3 vTangent;
					varying vec3 vBitangent;
					varying vec3 vPosition;
					varying vec2 vUv;
					uniform vec3 cspec;
					uniform sampler2D normalMap;
					uniform samplerCube envMap;
					uniform vec2 normalScale;
					uniform float roughness;
		
					const float PI = 3.14159;
					#define saturate(a) clamp( a, 0.0, 1.0 )
		
					float pow2( const in float x ) { return x*x; }
		
					// Trowbridge-Reitz distribution to Mip level, following the logic of http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html
					float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		
						float maxMIPLevelScalar = float( maxMIPLevel );
		
						float sigma = PI * roughness * roughness / ( 1.0 + roughness );
						float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		
						// clamp to allowable LOD ranges.
						return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
		
					}
		
					// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations
					vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
						return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
					}
		
					
		
					// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile
					vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
		
						float dotNV = saturate( dot( normal, viewDir ) );
		
						const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
		
						const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
		
						vec4 r = roughness * c0 + c1;
		
						float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
		
						vec2 brdf = vec2( -1.04, 1.04 ) * a004 + r.zw;
		
						return specularColor * brdf.x + brdf.y;
		
					} 
		
					
		
					void main() {
						vec3 normal = normalize( vNormal );
						vec3 tangent = normalize( vTangent );
						vec3 bitangent = normalize( vBitangent );
						mat3 vTBN = mat3( tangent, bitangent, normal );
						vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
						mapN.xy = normalScale * mapN.xy;
						vec3 n = normalize( vTBN * mapN );
						vec3 v = normalize( -vPosition);
						vec3 vReflect = reflect(vPosition,n);
						vec3 r = inverseTransformDirection( vReflect, viewMatrix );
		
						float alpha = roughness * roughness;
						float specularMIPLevel = getSpecularMIPLevel(alpha,8 );
		
						 vec3 envLight = textureCubeLodEXT( envMap, vec3(-r.x, r.yz), specularMIPLevel ).rgb;
						 // texture in sRGB, linearize
						envLight = pow( envLight, vec3(2.2));
						vec3 outRadiance = envLight*BRDF_Specular_GGX_Environment(n, v, cspec, alpha);
						// gamma encode the final value
						gl_FragColor = vec4(pow( outRadiance, vec3(1.0/2.2)), 1.0);
						//gl_FragColor = vec4(r,1.0);
					}
				</script>
				<script type="text/x-glsl" id="vertex_color">
					varying vec3 vNormal;
					varying vec3 vPosition;
			
					void main() {
						vec4 vPos = modelViewMatrix * vec4( position, 1.0 );
						vPosition = vPos.xyz;
						vNormal = normalMatrix * normal;
						gl_Position = projectionMatrix * vPos;
					}
					</script>
			
					<script type="text/x-glsl" id="fragment_color">
						varying vec3 vNormal;
						varying vec3 vPosition;
						uniform vec3 pointLightPosition; // in world space
						uniform vec3 clight;
						uniform vec3 cspec;  // f0
						uniform float roughness;
						const float PI = 3.14159;
			
						vec3 FSchlick(float vDoth, vec3 f0) {
							return f0 + (vec3(1.0)-f0)*pow(1.0 - vDoth,5.0);
						}
			
						float DGGX(float NoH, float alpha) {
							float alpha2 = alpha * alpha;
							float k = NoH*NoH * (alpha2 - 1.0) + 1.0;
							return alpha2 / (PI * k * k );
						}
			
						float G1(float nDotv, float alpha) {
							float alpha2 = alpha*alpha;
							return 2.0 * (nDotv / (nDotv + sqrt(alpha2 + (1.0-alpha2)*nDotv*nDotv )));
						}
			
						float GSmith(float nDotv, float nDotl, float alpha) {
							return G1(nDotl,alpha)*G1(nDotv,alpha);
						}
			
						void main() {
							vec4 lPosition = viewMatrix * vec4( pointLightPosition, 1.0 );
							vec3 l = normalize(lPosition.xyz - vPosition.xyz);
							vec3 n = normalize( vNormal );  // interpolation destroys normalization, so we have to normalize
							vec3 v = normalize( -vPosition);
							vec3 h = normalize( v + l);
							// small quantity to prevent divisions by 0
							float nDotl = max(dot( n, l ),0.00001);
							float lDoth = max(dot( l, h ),0.00001);
							float nDoth = max(dot( n, h ),0.00001);
							float vDoth = max(dot( v, h ),0.00001);
							float nDotv = max(dot( n, v ),0.00001);
							float alpha = roughness * roughness; // as in UE4 
							vec3 specularBRDF = FSchlick(vDoth, cspec)*GSmith(nDotv,nDotl, alpha)*DGGX(nDoth,alpha)/(4.0*nDotl*nDotv);
							vec3 outRadiance = PI* clight * nDotl * specularBRDF;
							// gamma encode the final value
							gl_FragColor = vec4(pow( outRadiance, vec3(1.0/2.2)), 1.0);
						}
					</script>
					

		<script type="text/x-glsl" id="vertex_textures">
				attribute vec4 tangent;
				varying vec3 vNormal;
				varying vec3 vPosition;
				varying vec2 uVv;
				varying vec2 vUv;
				varying vec3 vTangent;
				varying vec3 vBitangent;
		
				void main() {
					vec4 vPos = modelViewMatrix * vec4( position, 1.0 );
					vPosition = vPos.xyz;
					vNormal = normalize(normalMatrix * normal);
					vec3 objectTangent = vec3( tangent.xyz );
					vec3 transformedTangent = normalMatrix * objectTangent;
					vTangent = normalize( transformedTangent );
					// w is 1 or -1 depending on the sign of det( M tangent )
					vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
					vUv = uv;
					gl_Position = projectionMatrix * vPos;
				}
				</script>
		
				<script type="text/x-glsl" id="fragment_textures">
					varying vec3 vNormal;
					varying vec3 vTangent;
					varying vec3 vBitangent;
					varying vec3 vPosition;
					varying vec2 uVv;
					varying vec2 vUv;
					uniform vec3 pointLightPosition; // in world space
					uniform vec3 clight;
					uniform sampler2D specularMap;
					uniform sampler2D diffuseMap;
					uniform sampler2D roughnessMap;
					uniform sampler2D normalMap;
					uniform vec2 normalScale;
					uniform vec2 textureRepeat;
					const float PI = 3.14159;
		
					vec3 cdiff;
					vec3 cspec;
					float roughness;
		
					vec3 FSchlick(float vDoth, vec3 f0) {
						return f0 + (vec3(1.0)-f0)*pow(1.0 - vDoth,5.0);
					}
		
					float DGGX(float NoH, float alpha) {
						float alpha2 = alpha * alpha;
						float k = NoH*NoH * (alpha2 - 1.0) + 1.0;
						return alpha2 / (PI * k * k );
					}
		
					float G1(float nDotv, float alpha) {
						float alpha2 = alpha*alpha;
						return 2.0 * (nDotv / (nDotv + sqrt(alpha2 + (1.0-alpha2)*nDotv*nDotv )));
					}
		
					float GSmith(float nDotv, float nDotl, float alpha) {
						return G1(nDotl,alpha)*G1(nDotv,alpha);
					}
		
					void main() {
						vec4 lPosition = viewMatrix * vec4( pointLightPosition, 1.0 );
						vec3 l = normalize(lPosition.xyz - vPosition.xyz);
						vec3 normal = normalize( vNormal );
						vec3 tangent = normalize( vTangent );
						vec3 bitangent = normalize( vBitangent );
						// matrix to convert bewtween tangent space and view space
						mat3 vTBN = mat3( tangent, bitangent, normal );
						vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
						vec3 n = normalize( vTBN * mapN  );  // interpolation destroys normalization, so we have to normalize
						vec3 v = normalize( -vPosition);
						vec3 h = normalize( v + l);
						// small quantity to prevent divisions by 0
						float nDotl = max(dot( n, l ),0.000001);
						float lDoth = max(dot( l, h ),0.000001);
						float nDoth = max(dot( n, h ),0.000001);
						float vDoth = max(dot( v, h ),0.000001);
						float nDotv = max(dot( n, v ),0.000001);
		
						cdiff = texture2D( diffuseMap, vUv*textureRepeat ).rgb;
						// texture in sRGB, linearize
						cdiff = pow( cdiff, vec3(2.2));
						cspec = texture2D( specularMap, vUv*textureRepeat ).rgb;
						// texture in sRGB, linearize
						cspec = pow( cspec, vec3(2.2));
						roughness = texture2D( roughnessMap, vUv*textureRepeat).r; // no need to linearize roughness map
						vec3 fresnel = FSchlick(vDoth, cspec);
						float alpha = roughness * roughness;
						vec3 BRDF = (vec3(1.0)-fresnel)*cdiff/PI + fresnel*GSmith(nDotv,nDotl, alpha)*DGGX(nDoth,alpha)/
							(4.0*nDotl*nDotv);
						vec3 outRadiance = PI* clight * nDotl * BRDF;
						// gamma encode the final value
						gl_FragColor = vec4(pow( outRadiance, vec3(1.0/2.2)), 1.0);
					}
				</script>
			<!-- shaders -->
	</head>
	

	<body>
			<!--HEADER-->
		<header id="header" style="background-color: #fff;" data-uk-sticky="show-on-up: true; animation: uk-animation-fade; media: @l">
			<div class="uk-container">
				<nav id="navbar" data-uk-navbar="mode: click;">
					<div class="uk-navbar-center nav-overlay">
						<a class="uk-navbar-item uk-logo" href="#" title="Logo"><img src="images/site/Vespa.png" alt="Logo"></a>
					</div>
					
				</nav>
			</div>
		</header>
    <!--/HEADER-->
    
    <!-- NAVIGATION -->
    <div class="top-wrap uk-position-relative uk-light uk-background-secondary">
		<div class="uk-container">
			<nav class="nav-scroll">
				<ul class="uk-subnav uk-flex uk-flex-between uk-flex-nowrap">
					<li><a href="index.html">Home</a></li>
					<li class="uk-active"><a href="configuratore.html">Configuratore</a></li>
					<li><a href="#">Chi Siamo</a></li>
					<li><a href="#">Contatti</a></li>
					<li><a href="#">Report</a></li>
				</ul>
			</nav>
    </div>
    </div>
		<!-- /NAVIGATION -->
			
    <div class="uk-section uk-section-default">
			<div class="uk-container uk-margin-remove-right">
				<div class="uk-grid" data-ukgrid="">
					<div class="uk-width-2-3@m">
            <script id="can" src="js/main.js"></script>
					
					</div>
					<div class="uk-width-1-3@m">
						
						<h4 class="uk-heading-line uk-text-bold"><span>Configura la tua <img data-src="images/site/Vespa.png" width="95px" alt="" uk-img></span></h4>
						<div class="uk-tile uk-tile-small uk-tile-muted uk-border-rounded">
							<h5 class="uk-heading-line"><span>Seleziona materiale scocca</span></h5>
							<img class="uk-border-rounded" src="images/site/configuratore/color_azzurro.png" width="90" onClick="cambiaMateriale('azzurro')">
							<img class="uk-border-rounded" src="images/site/configuratore/chrome.jpg" width="90"  onClick="cambiaMateriale('cromato')">
							<img class="uk-border-rounded" src="images/site/configuratore/ruggine.jpg" width="90" onClick="cambiaMateriale('ruggine')">
							<h5 class="uk-heading-line"><span>Seleziona materiale sella</span></h5>
							<img class="uk-border-rounded" src="images/site/configuratore/pelle.jpg" width="90px" onClick="cambiaMaterialeSella('Leather001_2K')">
							<img class="uk-border-rounded" src="images/site/configuratore/stoffa.png" width="90px"  onClick="cambiaMaterialeSella('Fabric030_2K')">
							<img class="uk-border-rounded" src="images/site/configuratore/tessuto.png" width="90px" onClick="cambiaMaterialeSella('Fabric008_2K')">
							<h5 class="uk-heading-line"><span>Seleziona materiale manopola</span></h5>
							<img class="uk-border-rounded" src="images/site/configuratore/manopola_nera.png" width="90px" onClick="cambiaMaterialeManopola('Tiles072_2K')">
							<img class="uk-border-rounded" src="images/site/configuratore/manopola_bianca.png" width="90px"  onClick="cambiaMaterialeManopola('TexturesCom')">
							<img class="uk-border-rounded" src="images/site/configuratore/tessuto.png" width="90px" onClick="cambiaMaterialeManopola('Fabric008_2K')">
							<h5 class="uk-heading-line"><span>Seleziona colore cerchi</span></h5>
							<h5 class="uk-heading-line"><span>Seleziona sfondo</span></h5>
							<img class="uk-border-rounded" src="images/site/configuratore/background_bosco.png" width="90" onClick="cambiaAmbiente('bosco')">
							<img class="uk-border-rounded" src="images/site/configuratore/background_mare.png" width="90"  onClick="cambiaAmbiente('mare')">
							<img class="uk-border-rounded" src="images/site/configuratore/ruggine.jpg" width="90" onClick="cambiaAmbiente('piazza')">
							
							
						</div>
						<div class="uk-tile uk-tile-small uk-tile-muted uk-border-rounded">
										Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
										tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
										quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
										consequat. Duis aute irure dolor in.
						</div>
						<div class="uk-tile uk-tile-small uk-tile-muted uk-border-rounded">
										Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
										tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
										quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
										consequat. Duis aute irure dolor in.
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<!-- FOOTER -->
		<footer id="footer" class="uk-section uk-section-secondary uk-padding-remove-bottom">
			<div class="uk-container">
				<div class="uk-grid uk-grid-large" data-uk-grid>
					<div class="uk-width-1-2@m">
						<h5>OUR COMPANY</h5>
						<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud cillum dolore eu fugiat nulla contact to: <a href="#" title="">info@company.com</a></p>
						<div>
							<a href="" class="uk-icon-button" data-uk-icon="twitter"></a>
							<a href="" class="uk-icon-button" data-uk-icon="facebook"></a>
							<a href="" class="uk-icon-button" data-uk-icon="instagram"></a>
						</div>
					</div>
					<div class="uk-width-1-6@m">
						<h5>PRODUCTS</h5>
						<ul class="uk-list">
							<li>Big Data</li>
							<li>Marketing</li>
							<li>Analytics</li>
							<li>AI Lab</li>
						</ul>
					</div>
					<div class="uk-width-1-6@m">
						<h5>OUR COMPANY</h5>
						<ul class="uk-list">
							<li>Team</li>
							<li>Work</li>
							<li>Culture</li>
							<li>Contact Us</li>
						</ul>
					</div>
					<div class="uk-width-1-6@m">
						<h5>OUR OFFICES</h5>
						<ul class="uk-list">
							<li>London</li>
							<li>Chicago</li>
							<li>Dubai</li>
							<li>Brussels</li>
						</ul>
					</div>
					
				</div>
			</div>
			
			<div class="uk-text-center uk-padding uk-padding-remove-horizontal">
        <span class="uk-text-small uk-text-center">© 2021 | <a href="https://github.com/Interactive3DGraphicsCourse-UNIUD-2020/ProductConfiguration-lucaandaloro" title="Created by Luca Andaloro">Created by Luca Andaloro</a> | Built with <a href="http://getuikit.com" title="Visit UIkit 3 site" target="_blank" data-uk-tooltip><span data-uk-icon="uikit"></span></a></span>
			</div>
		</footer>
		<!-- /FOOTER -->
		
		
		<!-- JS FILES -->
		<script src="https://cdn.jsdelivr.net/npm/uikit@latest/dist/js/uikit.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/uikit@latest/dist/js/uikit-icons.min.js"></script>
	</body>
</html>